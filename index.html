<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OKAZUstudio</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="styles.css">
</head>
<body class="flex flex-col h-screen">

    <!-- Brush Cursor -->
    <div id="brush-cursor"></div>

    <!-- Drag Overlay -->
    <div id="drag-overlay" class="absolute inset-0 z-50 pointer-events-none items-center justify-center">
        <div class="text-white text-3xl font-bold bg-black/50 px-8 py-4 rounded-xl backdrop-blur-sm">
            Drop Images Here
        </div>
    </div>

    <!-- Error Console -->
    <div id="error-console"></div>

    <!-- Loading Overlay -->
    <div id="loading-overlay" class="fixed inset-0 z-[100] bg-black/50 backdrop-blur-sm flex flex-col items-center justify-center hidden">
        <div class="spinner mb-4"></div>
        <div class="text-white font-bold text-xl tracking-widest">PROCESSING</div>
    </div>

    <!-- Hint Legend -->
    <div id="hint-legend">
        <div><span class="key">Space</span> (Hold) to Pan</div>
        <div class="mt-1"><span class="key">Space</span> (Double-tap) to Reset View</div>
        <div class="mt-1"><span class="key">Wheel</span> to Zoom</div>
        <div class="mt-1"><span class="key">Ctrl+Wheel</span> or <span class="key">[ ]</span> Brush Size</div>
        <div class="mt-1"><span class="key">Ctrl+Click</span> Draw Line</div>
        <div class="mt-1"><span class="key">Ctrl+Z</span> Undo &bull; <span class="key">Ctrl+Y</span> Redo</div>
    </div>

    <!-- Adjustment Drawer (Right) -->
    <div id="adj-drawer" class="flex items-center">
        <!-- Lip -->
        <div class="w-6 h-24 bg-panel-strong rounded-l-lg border-y border-l border-panel flex items-center justify-center cursor-pointer shadow-lg">
            <svg class="w-4 h-4 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path></svg>
        </div>
        <!-- Drawer Content -->
        <div class="w-72 bg-panel border border-panel p-4 shadow-2xl rounded-bl-lg max-h-[80vh] overflow-y-auto">
            <div class="flex justify-between items-center mb-4 border-b border-panel-divider pb-2">
                <h3 class="text-xs font-bold text-gray-400 uppercase tracking-widest">Adjustments</h3>
                <button id="resetAdjBtn" class="text-[10px] text-accent hover:text-white uppercase tracking-wider font-bold">Reset All</button>
            </div>
            <!-- Sliders -->
            <div class="drawer-slider-group">
                <div class="drawer-label"><span>Gamma</span> <span id="val-gamma" class="val-display">1.00</span></div>
                <input id="adj-gamma" type="range" min="0.0" max="2.0" step="0.01" value="1.0" class="w-full" data-default="1.0">
            </div>
            <div class="drawer-slider-group">
                <div class="drawer-label"><span>Shadows</span> <span id="val-shadows" class="val-display">0</span></div>
                <input id="adj-shadows" type="range" min="-100" max="100" value="0" class="w-full" data-default="0">
            </div>
            <div class="drawer-slider-group">
                <div class="drawer-label"><span>Highlights</span> <span id="val-highlights" class="val-display">0</span></div>
                <input id="adj-highlights" type="range" min="-100" max="100" value="0" class="w-full" data-default="0">
            </div>
            <div class="drawer-divider"></div>
            <div class="section-header">
                <span class="section-title">Levels</span>
                <button id="resetLevelsBtn" class="section-reset">Reset</button>
            </div>
            <div class="drawer-slider-group">
                <div class="drawer-label"><span>Black Point</span> <span id="val-l-black" class="val-display">0</span></div>
                <input id="adj-l-black" type="range" min="0" max="255" value="0" class="w-full" data-default="0">
            </div>
            <div class="drawer-slider-group">
                <div class="drawer-label"><span>Mid Point</span> <span id="val-l-mid" class="val-display">1.00</span></div>
                <input id="adj-l-mid" type="range" min="0.0" max="2.0" step="0.01" value="1.0" class="w-full" data-default="1.0">
            </div>
            <div class="drawer-slider-group">
                <div class="drawer-label"><span>White Point</span> <span id="val-l-white" class="val-display">255</span></div>
                <input id="adj-l-white" type="range" min="0" max="255" value="255" class="w-full" data-default="255">
            </div>
            <div class="drawer-divider"></div>
             <div class="section-header">
                <span class="section-title">Color</span>
                <button id="resetSatBtn" class="section-reset">Reset</button>
            </div>
            <div class="drawer-slider-group">
                <div class="drawer-label"><span>Saturation</span> <span id="val-sat" class="val-display">0</span></div>
                <input id="adj-sat" type="range" min="-100" max="100" value="0" class="w-full" data-default="0">
            </div>
             <div class="drawer-slider-group">
                <div class="drawer-label"><span>Vibrance</span> <span id="val-vib" class="val-display">0</span></div>
                <input id="adj-vib" type="range" min="-100" max="100" value="0" class="w-full" data-default="0">
            </div>
            <div class="drawer-divider"></div>
            <div class="drawer-slider-group">
                <div class="drawer-label"><span>White Balance</span> <span id="val-wb" class="val-display">6500K</span></div>
                <input id="adj-wb" type="range" min="-100" max="100" value="0" class="w-full" data-default="0">
            </div>
            <div class="drawer-divider"></div>
            <div class="section-header">
                <span class="section-title">Color Balance</span>
                <button id="resetColorBtn" class="section-reset">Reset</button>
            </div>
            <div class="drawer-slider-group">
                <div class="drawer-label"><span>Cyan - Red</span> <span id="val-cb-r" class="val-display">0</span></div>
                <input id="adj-cb-r" type="range" min="-100" max="100" step="0.4" value="0" class="w-full" data-default="0">
            </div>
            <div class="drawer-slider-group">
                <div class="drawer-label"><span>Magenta - Green</span> <span id="val-cb-g" class="val-display">0</span></div>
                <input id="adj-cb-g" type="range" min="-100" max="100" step="0.4" value="0" class="w-full" data-default="0">
            </div>
            <div class="drawer-slider-group">
                <div class="drawer-label"><span>Yellow - Blue</span> <span id="val-cb-b" class="val-display">0</span></div>
                <input id="adj-cb-b" type="range" min="-100" max="100" step="0.4" value="0" class="w-full" data-default="0">
            </div>
        </div>
    </div>

    <!-- Vertical Toolbox (Left) -->
    <div style="top: max(30%, 300px);" class="absolute left-0 transform -translate-y-1/2 bg-panel border-y border-r border-panel rounded-r-lg p-2 flex flex-col gap-2 z-40 shadow-xl">
        <!-- Undo / Redo -->
        <div class="flex flex-col gap-2 border-b border-panel-divider pb-2 mb-1">
            <button id="undoBtn" class="icon-btn" title="Undo (Ctrl+Z)" disabled>
                <img src="icons/undo.svg" alt="Undo" class="w-5 h-5" draggable="false">
            </button>
            <button id="redoBtn" class="icon-btn" title="Redo (Ctrl+Y)" disabled>
                <img src="icons/redo.svg" alt="Redo" class="w-5 h-5" draggable="false">
            </button>
        </div>
        <!-- View Toggles -->
        <div class="flex flex-col gap-2 border-b border-panel-divider pb-2 mb-1">
            <button id="toggleBackBtn" class="icon-btn" title="Toggle Rear Image Visibility">
                <img id="rearEyeOpen" src="icons/back_show.svg" alt="Show Back" class="w-5 h-5" draggable="false">
                <img id="rearEyeClosed" src="icons/back_hide.svg" alt="Hide Back" class="w-5 h-5 hidden" draggable="false">
            </button>
            <button id="toggleMaskBtn" class="icon-btn" title="Toggle Holes Visibility">
                <img id="maskEyeOpen" src="icons/edits_show.svg" alt="Show Edits" class="w-5 h-5" draggable="false">
                <img id="maskEyeClosed" src="icons/edits_hide.svg" alt="Hide Edits" class="w-5 h-5 hidden" draggable="false">
            </button>
        </div>

        <!-- Crop Tool -->
        <div class="flex flex-col gap-2 border-b border-gray-700 pb-2 mb-1">
            <button id="cropBtn" class="icon-btn hover:text-yellow-400" title="Crop Canvas">
                <img src="icons/crop.svg" alt="Crop" class="w-5 h-5" draggable="false">
            </button>
        </div>

        <!-- Actions -->
        <button id="swapBtn" class="icon-btn text-accent" title="Swap Front/Back">
            <img src="icons/swap.svg" alt="Swap" class="w-5 h-5" draggable="false">
        </button>
        <button id="censorBtn" class="icon-btn text-purple-400" title="Censor (Mosaic+Blur Back)">
            <img src="icons/censor.svg" alt="Censor" class="w-5 h-5" draggable="false">
        </button>
        <button id="mergeBtn" class="icon-btn hover:text-green-400" title="Merge Visible to Slot A">
            <img src="icons/merge.svg" alt="Merge" class="w-5 h-5" draggable="false">
        </button>
        <button id="clearMask" class="icon-btn hover:text-red-400" title="Reset">
            <img src="icons/reset.svg" alt="Reset" class="w-5 h-5" draggable="false">
        </button>
    </div>

    <!-- Top Toolbar -->
    <div class="h-12 bg-panel border-b border-panel flex items-center gap-4 px-4 z-50 shrink-0 overflow-x-auto relative" style="cursor: default;">
        <div class="flex flex-row gap-2 shrink-0">
            <input type="file" id="fileA" accept="image/*" class="hidden">
            <button onclick="document.getElementById('fileA').click()" id="btnA" class="tool-btn px-2 py-1 text-[10px] font-bold rounded border border-panel panel-btn w-24 truncate leading-tight">
                Load Img A
            </button>
            <input type="file" id="fileB" accept="image/*" class="hidden">
            <button onclick="document.getElementById('fileB').click()" id="btnB" class="tool-btn px-2 py-1 text-[10px] font-bold rounded border border-panel panel-btn w-24 truncate leading-tight">
                Load Img B
            </button>
        </div>
        <div class="w-px h-6 bg-panel-divider shrink-0"></div>
        <div class="flex items-center gap-4 shrink-0">
            <div class="flex bg-panel-strong rounded p-0.5">
                <button id="eraseMode" class="tool-btn active px-2 py-0.5 rounded text-[10px] font-medium">Erase</button>
                <button id="repairMode" class="tool-btn px-2 py-0.5 rounded text-[10px] font-medium">Repair</button>
            </div>
            <div class="flex flex-col gap-0.5 w-24">
                <div class="flex justify-between text-[10px] text-gray-400">
                    <span>Size (%)</span>
                    <span id="brushSizeVal">10</span>
                </div>
                <input type="range" id="brushSize" min="0" max="1000" step="1" value="329" class="w-full">
            </div>
            <div class="flex items-center gap-2">
                <div class="flex flex-col gap-0.5 w-24">
                    <div class="flex justify-between text-[10px] text-gray-400">
                        <span id="featherLabel">Hardness</span>
                        <span id="featherVal">95%</span>
                    </div>
                    <input type="range" id="feather" min="0" max="20" value="1" class="w-full">
                </div>
                <button id="featherModeBtn" class="feather-toggle" title="Toggle Fixed Feather">
                    <img src="icons/hardnormal.svg" alt="Hardness Mode" class="w-4 h-4" draggable="false">
                </button>
            </div>
        </div>
        <div class="w-px h-6 bg-panel-divider shrink-0"></div>
        <div class="flex flex-col gap-0.5 w-24 shrink-0">
            <div class="flex justify-between text-[10px] text-gray-400">
                <span>Opacity</span>
                <span id="opacityVal">80%</span>
            </div>
            <input type="range" id="opacitySlider" min="0" max="100" value="80" class="w-full">
        </div>
        <div class="ml-auto flex items-center gap-2">
            <button id="settingsBtn" class="tool-btn flex items-center justify-center w-8 h-8 rounded text-gray-400 hover:text-white" title="Settings">
                 <img src="icons/settings.svg" alt="Settings" class="w-5 h-5" draggable="false">
            </button>
            <button id="saveBtn" class="tool-btn flex items-center gap-2 text-white px-3 py-1.5 rounded shadow text-xs font-medium accent-action" title="Export PNG">
                <img src="icons/export.svg" alt="Export" class="w-4 h-4" draggable="false">
                <span>Export</span>
            </button>
        </div>
    </div>

    <!-- Main Workspace -->
    <div id="canvas-container" class="checkerboard relative w-full flex-grow flex flex-col overflow-hidden">
        <div id="workspace-labels">
            <div class="workspace-label workspace-label-top" aria-hidden="true">
                <span class="workspace-label-okazu">OKAZU</span>
                <span class="workspace-label-studio">studio</span>
            </div>
            <div id="workspace-resolution" class="workspace-label workspace-label-bottom workspace-label-resolution" aria-hidden="true" style="display:none">
                0Ã—0
            </div>
        </div>
        <div id="empty-state" class="absolute inset-0 flex items-center justify-center text-gray-500 pointer-events-none z-10">
            <div class="text-center">
                <svg class="w-16 h-16 mx-auto mb-4 opacity-50" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"></path></svg>
                <p class="text-xl font-medium">Load or Drop two images</p>
                <p class="text-sm mt-2 opacity-75">Space to Pan &bull; Wheel to Zoom</p>
            </div>
        </div>
        
        <!-- Dark overlay for workspace when cropping -->
        <div id="backdrop-dimmer"></div>

        <div id="viewport" class="disabled">
            <div id="canvas-wrapper">
                <canvas id="mainCanvas" class="shadow-2xl hidden"></canvas>
                <canvas id="previewCanvas" class="shadow-2xl absolute inset-0 w-full h-full pointer-events-none hidden"></canvas>
                
                <!-- Crop UI Elements (DOM based) -->
                <div id="crop-overlay-dom">
                    <div id="crop-box">
                        <div class="crop-handle handle-nw" data-handle="nw"></div>
                        <div class="crop-handle handle-n" data-handle="n"></div>
                        <div class="crop-handle handle-ne" data-handle="ne"></div>
                        <div class="crop-handle handle-e" data-handle="e"></div>
                        <div class="crop-handle handle-sw" data-handle="sw"></div>
                        <div class="crop-handle handle-w" data-handle="w"></div>
                        <div class="crop-handle handle-se" data-handle="se"></div>
                        <div class="crop-handle handle-s" data-handle="s"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="adjustments.js"></script>
    <script src="undo.js"></script>
    <script src="input.js"></script>
    <script src="settings.js"></script>
    <script src="main.js"></script>
</body>
</html>
